{% extends 'base.html' %}
{% load static %}
{% block title %}1日スケジュール編集 - Kajisuke{% endblock %}
{% block description %}Kajisukeのスケジュール編集ページ{% endblock %}
{% block extra_css %}
<link href="{% static 'css/schedules/edit_oneday.css' %}" rel="stylesheet">

<script src="/static/js/oneday_edit.js" defer></script>
{% endblock %}
{% block content %}
<h2>この日のみの変更</h2>

<form method="post" id="exception-form">
    {% csrf_token %}

    <div class="form-group">
        <label>予定日</label>
        <input type="text" value="{{ form.initial.original_date }}" readonly class="form-control">
    </div>

    <div class="form-group">
        <label>変更日</label><br>
        <input type="date" name="modified_date" id="id_modified_date" class="form-control">
    </div>

    <div class="form-group">
        <label>カテゴリー</label>
        <input type="text" value="{{ schedule.task.task_category.task_category_name }}" readonly class="form-control">
    </div>

    <div class="form-group">
        <label>家事</label>
        <input type="text" value="{{ schedule.task.task_name }}" readonly class="form-control">
    </div>

    <div class="form-group">
        <label>メモ</label>
        <input type="text" value="{{ schedule.memo }}" readonly class="form-control">
    </div>



    <button type="button" class="submit1" id="change-only-btn">この日のみ変更する</button>


    <button type="button" class="submit2" id="delete-only-btn">この日のみ削除する</button>

    <!-- モーダル -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-content">
            <p id="modal-message"></p>
            <button id="modal-confirm" class="submit1">実行</button>
            <button type="button" id="modal-cancel" class="submit2">キャンセル</button>
        </div>
    </div>

    <button type="button" class="submit2" onclick="window.location.href='{% url 'apps:schedule_edit' schedule.id  %}'">
        繰り返し設定を変更する
    </button>


</form>
{% if is_modified %}
<div id="modified-modal" class="modal">
    <div class="modal-content">
        <p>この日の予定はすでに変更・削除されています。</p>
        <button id="modified-ok-btn" class="submit1">OK</button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("modified-modal").classList.remove("hidden");
        // OKボタンでカレンダーにリダイレクト
        document.getElementById("modified-ok-btn").addEventListener("click", () => {
            window.location.href = "{% url 'apps:calendar_redirect' %}";
        });
    });
</script>
<script>
    window.scheduledDate = "{{ form.initial.original_date }}";
    window.isModified = {{ is_modified|yesno:"true,false" }};
    window.calendarRedirectUrl = "{% url 'apps:daily_schedule' year=form.initial.original_date.year month=form.initial.original_date.month day=form.initial.original_date.day %}";
</script>
{% endif %}

{% endblock %}